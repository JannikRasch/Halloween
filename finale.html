<!doctype html>
<html lang="de"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Der Kreis der Erlösung</title>
<style>

@import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap');
body{margin:0;padding:1.2rem;background:radial-gradient(circle at 20% 20%, #050507, #000);color:#e6e2d3;font-family:'Cinzel Decorative',serif;min-height:100vh;overflow-y:auto;}
.container{max-width:920px;margin:0 auto;}
.card{background:rgba(10,10,12,0.6);padding:18px;border-radius:12px;}
.playbtn{background:#0b1220;color:#9fd8ff;border-radius:8px;padding:10px 14px;border:none;cursor:pointer}
.input{display:block;width:100%;padding:10px;margin-top:12px;border-radius:8px;border:1px solid #333;background:#0c0c0e;color:#efe7c6}

body{background:radial-gradient(circle at 30% 20%, #001021, #000018); color:#dfefff}
.card{background:rgba(5,10,20,0.75);border:1px solid rgba(80,160,255,0.06)}
.runecanvas{width:100%;height:360px;display:block;margin:16px 0}
.playbtn{background:#062033;color:#bfe9ff;padding:10px 14px;border-radius:8px;border:none;cursor:pointer}
.final-button{background:#08314a;color:#cfeeff;padding:10px 14px;border-radius:10px;border:1px solid rgba(150,220,255,0.06)}
.success-box{background:rgba(10,30,50,0.6);border:1px solid rgba(120,200,255,0.08);padding:12px;border-radius:8px;margin-top:12px}
</style>
</head><body>
<div class="container"><div class="card">
<h1>Der Kreis der Erlösung</h1>
<div class="hintbox"><p>Im Finale prüft das Siegel eure Antworten. Wenn alles stimmt, werdet ihr den Gegenzauber sprechen können.</p></div>
<canvas id="runecast" class="runecanvas"></canvas>
<div id="interaction" style="margin-top:12px">
    <p class="small">Drückt auf 'Prüfe das Siegel' um zu sehen, ob eure Antworten korrekt sind.</p>

    <!-- neue Eingabefelder: fünf Zeilen mit Zutat + Menge -->
    <div id="ingredients" style="display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center;margin:12px 0;">
      <label style="grid-column:1/3;font-size:0.9rem;color:#cfe7d0">Zutatenliste (Name, Menge)</label>

      <input class="ing-name input" placeholder="Zutat 1 (z.B. kerze)" />
      <input class="ing-qty input" placeholder="Menge" style="width:110px" />

      <input class="ing-name input" placeholder="Zutat 2" />
      <input class="ing-qty input" placeholder="Menge" style="width:110px" />

      <input class="ing-name input" placeholder="Zutat 3" />
      <input class="ing-qty input" placeholder="Menge" style="width:110px" />

      <input class="ing-name input" placeholder="Zutat 4" />
      <input class="ing-qty input" placeholder="Menge" style="width:110px" />

      <input class="ing-name input" placeholder="Zutat 5" />
      <input class="ing-qty input" placeholder="Menge" style="width:110px" />
    </div>

    <button id="checkAll" class="final-button">Prüfe das Siegel</button>
    <div id="results" style="margin-top:12px"></div>
  </div>
<script>
document.getElementById('playBtn')?.addEventListener('click', function(){ document.getElementById('audio')?.play(); });

const canvas = document.getElementById('runecast');
const ctx = canvas.getContext('2d');
function resize(){ canvas.width = canvas.clientWidth; canvas.height = canvas.clientHeight; }
window.addEventListener('resize', resize); resize();
const runes = ['ᚠ','ᚢ','ᚦ','ᚨ','ᚱ','ᚲ','ᚺ','ᚾ','ᛃ','ᛇ','ᛈ','ᛉ','ᛋ','ᛏ','ᛒ','ᛖ','ᛗ','ᛚ','ᛜ','ᛞ','ᛟ'];
let angle=0; let glow=0; let success=false;
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const cx = canvas.width/2, cy = canvas.height/2, R = Math.min(canvas.width,canvas.height)/3;
  const g = ctx.createRadialGradient(cx,cy,10,cx,cy,R*1.4);
  g.addColorStop(0,'rgba(40,80,120,0.12)'); g.addColorStop(1,'rgba(0,0,0,0)');
  ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width,canvas.height);
  for(let i=0;i<16;i++){
    const a = angle + i*(Math.PI*2/16);
    const x = cx + Math.cos(a)*R, y = cy + Math.sin(a)*R;
    ctx.font = Math.floor(R/5)+'px serif';
    ctx.fillStyle = success ? 'rgba(180,240,255,'+(0.5+0.4*Math.sin(angle*3))+')' : 'rgba(140,190,220,0.26)';
    ctx.save(); ctx.translate(x,y); ctx.rotate(a+Math.PI/2); ctx.fillText(runes[(i*3)%runes.length], -12, 6); ctx.restore();
  }
  ctx.beginPath();
  ctx.arc(cx,cy, R*0.45, 0, Math.PI*2);
  ctx.strokeStyle = success ? 'rgba(160,220,255,0.9)' : 'rgba(120,180,220,0.35)';
  ctx.lineWidth = success ? 6 : 2; ctx.stroke();
  glow += 0.03;
  const galpha = 0.08 + 0.04*Math.sin(glow*2);
  ctx.fillStyle = 'rgba(90,150,200,'+galpha+')'; ctx.beginPath(); ctx.arc(cx,cy, R*0.15,0,Math.PI*2); ctx.fill();
  angle += 0.002 + (success?0.01:0);
  requestAnimationFrame(draw);
}
draw();

// Erwartete Zutaten (nur noch diese Prüfung wird ausgeführt)
const correct = {
  "ingredients": [
    {name: "kerze", qty: "6"},
    {name: "blut",  qty: "9"},
    {name: "asche", qty: "7"},
    {name: "salz",  qty: "2"},
    {name: "wasser",qty: "3"}
  ]
};

document.getElementById('checkAll').addEventListener('click', function(){
  const out = document.getElementById('results');
  out.innerHTML = '';

  const names = Array.from(document.querySelectorAll('.ing-name')).map(i=>i.value.trim().toLowerCase());
  const qtys  = Array.from(document.querySelectorAll('.ing-qty')).map(i=>i.value.trim().toLowerCase());

  out.innerHTML += '<hr style="opacity:.08" />';
  let ingAll = true;

  correct.ingredients.forEach((exp, idx) => {
    const givenName = (names[idx]||'').toLowerCase();
    const givenQty  = (qtys[idx]||'').toLowerCase();
    const okName = givenName === (exp.name||'').toLowerCase();
    const okQty  = givenQty === (exp.qty||'').toLowerCase();

    if(okName && okQty){
      out.innerHTML += '<div style="color:#9be89b">Zutat '+(idx+1)+': '+exp.name+' ×'+exp.qty+' — Korrekt</div>';
    } else {
      let msg = '<div style="color:#f18b8b">Zutat '+(idx+1)+': ';
      msg += givenName ? givenName + ' ×' + (givenQty||'?') : '(leer)';
      msg += ' — FALSCH';
      msg += '</div>';
      out.innerHTML += msg;
      ingAll = false;
    }
  });

  if(ingAll){
    out.innerHTML += '<div class="success-box">Alle Zutaten korrekt! Der Gegenzauber wird gesprochen...</div>';
    success = true;
    try { new Audio('audio/sfx_chime.mp3').play(); } catch(e) {}
    setTimeout(function(){ try { new Audio('audio/finale.mp3').play(); } catch(e){} },900);
  } else {
    success = false;
    try { new Audio('audio/sfx_wrong.mp3').play(); } catch(e) {}
  }
});
</script>
</body></html>